<div id="shift-detail-root">
    <div class="header">
        <button class="btn-back-header" data-bind="click: goBack">戻る</button>
    </div>

    <div data-bind="visible: error()" style="color:#d33; padding: 10px; background: #ffe6e6; margin: 10px;">
        <span data-bind="text: error()"></span>
    </div>

    <div data-bind="visible: loading()" class="loading">
        読み込み中...
    </div>


    <div data-bind="visible: isReady()" class="main-content">
    <div class="left-section">
        <div class="shift-basic-info">
            <div class="shift-header">
                <h2 class="shift-title" data-bind="text: shiftTitle()">シフト詳細</h2>
                <div class="shift-date" data-bind="text: shiftDate()">読み込み中...</div>
            </div>
        </div>
        
        <div class="participants-section">
            <h3>参加者一覧</h3>
            <div class="participants-list">
                <!-- ko foreach: participants -->
                <div class="participant-item">
                    <div class="participant-icon"></div>
                    <div class="participant-info">
                        <div class="participant-name" data-bind="text: name"></div>
                        <div class="participant-status" data-bind="text: status"></div>
                        <!-- ko if: self_word && self_word.trim() !== '' -->
                        <div class="participant-comment">
                            <strong>コメント:</strong> <span data-bind="text: self_word"></span>
                        </div>
                        <!-- /ko -->
                    </div>
                </div>
                <!-- /ko -->
                <!-- ko if: participants().length === 0 -->
                <div class="no-participants">
                    参加者がいません
                </div>
                <!-- /ko -->
            </div>
        </div>
    </div>
    
    <div class="right-section">
        <div class="action-buttons">
            <h3>参加/取り消し</h3>
            <!-- 参加ボタン（未参加時のみ表示） -->
            <button type="button" class="action-btn btn-participate" 
                    data-bind="visible: shift() && !isParticipating() && canParticipate(), 
                               click: function() { console.log('参加ボタンクリック！'); $root.joinShift($root.shift()); }"
                    onclick="console.log('直接クリックイベント！');">
                参加する
            </button>
            
            <!-- 取消ボタン（参加時のみ表示） -->
            <button type="button" class="action-btn btn-cancel" 
                    data-bind="visible: shift() && isParticipating(), 
                               click: function() { $root.cancelShift($root.shift()); }">
                参加を取消
            </button>
            
            <!-- 定員満了メッセージ（定員満了時のみ表示） -->
            <span class="action-message" 
                  data-bind="visible: shift() && !canParticipate() && !isParticipating()">
                定員に達しています
            </span>
            
            <!-- 参加者一覧リンク -->
            <div class="participants-link" style="margin-top: 15px;">
                <a href="#" class="action-btn btn-participants" 
                   data-bind="attr: { href: '/shifts/' + shift().id + '/participants' }, 
                              visible: shift()">
                    参加者一覧を見る
                </a>
            </div>
        </div>
        
        <div class="recruitment-times">

            <h3>募集中の時刻</h3>
            <ul class="recruitment-details">
                <li>開始時刻: <span data-bind="text: shift() ? shift().start_time : ''"></span></li>
                <li>終了時刻: <span data-bind="text: shift() ? shift().end_time : ''"></span></li>
            </ul>
        </div>
    </div>
    </div>
    
    <!-- 詳細ページ用モーダル -->
    <div id="comment-modal-view" class="modal-overlay">
        <div class="modal-dialog" onclick="event.stopPropagation()">
            <h3 style="margin:0 0 8px;">ひとこと</h3>
            <textarea id="comment-textarea-view" rows="4" style="width:100%;"></textarea>
            <div style="margin-top:12px; text-align:right;">
                <button id="comment-cancel-btn-view" type="button">キャンセル</button>
                <button id="comment-ok-btn-view" type="button">OK</button>
            </div>
        </div>
    </div>
</div>