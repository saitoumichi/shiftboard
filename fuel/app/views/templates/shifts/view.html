<div id="shift-detail-root">
    <div class="header">
        <button class="btn-back-header" data-bind="click: goBack">戻る</button>
    </div>

    <div data-bind="visible: error()" style="color:#d33; padding: 10px; background: #ffe6e6; margin: 10px;">
        <span data-bind="text: error()"></span>
    </div>

    <div data-bind="visible: loading()" class="loading">
        読み込み中...
    </div>


    <div data-bind="visible: isReady()" class="main-content" style="display: flex; gap: 20px;">
        <div class="left-section" style="flex: 1;">
            <div class="shift-basic-info">
            
            <!-- 日表示の情報を追加 -->
            <div class="shift-details" data-bind="visible: shift()">
                <!-- シフト情報 -->
                <div class="shift-info">
                    <div class="shift-info-content">
                        <p style="color: #444444; font-size: 18px; font-weight: bold;" data-bind="text: shift() ? (shift().free_text || 'シフト情報なし') : 'シフト情報なし'"></p>
                        <p class="shift-id" style="color: #444444; font-size: 16px; font-weight: bold;">シフト作成者: <span data-bind="text: shift() ? shift().id : ''"></span></p>
                    </div>
                </div>

                <!-- 定員状況 -->
                <div class="shift-capacity">
                    <h4 style="color: #333333;">定員状況</h4>
                    <div class="capacity-info" style="color: #333333;">
                        <span data-bind="text: shift() ? shift().assigned_users.length : 0"></span> / 
                        <span data-bind="text: shift() ? shift().slot_count : 0"></span>人
                        <!-- ko if: shift() && shift().slot_count && shift().assigned_users && (shift().slot_count - shift().assigned_users.length) === 0 -->
                        <span class="capacity-full" style="color: #d32f2f;">(満員)</span>
                        <!-- /ko -->
                        <!-- ko if: shift() && shift().slot_count && shift().assigned_users && (shift().slot_count - shift().assigned_users.length) > 0 -->
                        <span class="capacity-available" style="color: #2e7d32;">(空き: <span data-bind="text: shift() ? (shift().slot_count - shift().assigned_users.length) : 0"></span>人)</span>
                        <!-- /ko -->
                    </div>
                </div>
            </div>
        </div>
        
        <div class="participants-section">
            <h3>参加者一覧</h3>
            <div class="participants-list">
                <!-- ko foreach: participants -->
                <div class="participant-item" style="display: flex; align-items: center; margin: 5px 0; padding: 8px; border-radius: 4px; background: #f9f9f9;">
                    <!-- カラー表示 -->
                    <div class="participant-color" style="width: 12px; height: 12px; border-radius: 50%; margin-right: 8px; flex-shrink: 0;" data-bind="style: { backgroundColor: $data.color }"></div>
                    <!-- 名前と一言 -->
                    <div style="flex: 1; display: flex; align-items: center; gap: 8px;">
                        <div class="participant-name" style="font-weight: bold; color: #333;" data-bind="text: $data.name"></div>
                        <!-- ko if: $data.self_word && $data.self_word.trim() !== '' -->
                        <div class="participant-comment" style="font-style: italic; color: #666; font-size: 0.9em;" data-bind="text: $data.self_word"></div>
                        <!-- /ko -->
                    </div>
                    <!-- 参加状況 -->
                    <div class="participant-status" style="margin-left: 8px; padding: 2px 6px; border-radius: 12px; font-size: 0.8em; font-weight: bold;" 
                         data-bind="text: $data.status === 'assigned' ? '参加' : ($data.status === 'cancelled' ? '欠席' : $data.status)"></div>
                </div>
                <!-- /ko -->
                <!-- ko if: participants().length === 0 -->
                <div class="no-participants" style="color: #999;">
                    参加者なし
                </div>
                <!-- /ko -->
            </div>
            </div>
        </div>
        
        <div class="right-section" style="flex: 1;">
            <div class="action-buttons">
            <h3>参加/取り消し</h3>
            <!-- ボタンコンテナ -->
            <div class="button-container" style="display: flex; gap: 10px; flex-wrap: wrap;">
                <!-- 参加ボタン（定員に空きがある時のみ表示） -->
                <button type="button" class="action-btn btn-participate" 
                        data-bind="visible: shift() && canParticipate(), 
                                   click: joinShift"
                        onclick="console.log('参加ボタンクリック！');">
                    参加
                </button>
                
                <!-- 取消ボタン（テスト用：常に表示） -->
                <button type="button" class="action-btn btn-cancel" 
                        style="display: block; background-color: #dc3545; color: white; padding: 8px 16px; border: none; border-radius: 4px; margin: 5px 0;"
                        onclick="console.log('取消ボタンクリック！');">
                    取消
                </button>
            </div>
            
            
        </div>
        
        <div class="recruitment-times">
            <h3>シフト情報</h3>
            <ul class="recruitment-details">
                <li>開始時刻: <span data-bind="text: shift() ? shift().start_time : ''"></span></li>
                <li>終了時刻: <span data-bind="text: shift() ? shift().end_time : ''"></span></li>
                <li>シフト作成者: <span data-bind="text: shift() ? shift().id : ''"></span></li>
            </ul>
        </div>
        
    </div>
    </div>
    
    <!-- 詳細ページ用モーダル -->
    <div id="comment-modal-view" class="modal-overlay">
        <div class="modal-dialog" onclick="event.stopPropagation()">
            <h3 style="margin:0 0 8px;">ひとこと</h3>
            <textarea id="comment-textarea-view" rows="4" style="width:100%;"></textarea>
            <div style="margin-top:12px; text-align:right;">
                <button id="comment-cancel-btn-view" type="button">キャンセル</button>
                <button id="comment-ok-btn-view" type="button">OK</button>
            </div>
        </div>
    </div>
    </div>
</div>